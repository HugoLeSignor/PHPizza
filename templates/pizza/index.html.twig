{% extends 'base.html.twig' %}

{% block title %}Mes Pizzas{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="container">
        <div class="page-header">
            <h1>üçï Mes Cr√©ations</h1>
            <p>Cr√©ez et personnalisez vos pizzas sur mesure</p>
        </div>

        <div class="content-grid">
            <!-- Formulaire de cr√©ation -->
            <div class="card">
                <h2>
                    <span>‚ûï</span>
                    Nouvelle Pizza
                </h2>
                
                {{ form_start(form) }}
                    <div class="form-group">
                        {{ form_label(form.name) }}
                        {{ form_widget(form.name, {'attr': {'placeholder': 'Ex: Pizza Royale'}}) }}
                        {{ form_errors(form.name) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(form.specialIngredient) }}
                        {{ form_widget(form.specialIngredient, {'attr': {'placeholder': 'Ex: Truffe noire'}}) }}
                        {{ form_errors(form.specialIngredient) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(form.doughType) }}
                        {{ form_widget(form.doughType) }}
                        {{ form_errors(form.doughType) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(form.ingredients) }}
                        <div class="ingredients-grid">
                            {% for child in form.ingredients %}
                                <div class="ingredient-item">
                                    {{ form_widget(child) }}
                                    {{ form_label(child) }}
                                </div>
                            {% endfor %}
                        </div>
                        {{ form_errors(form.ingredients) }}
                    </div>

                    <button type="submit" class="btn btn-primary">
                        üé® Cr√©er ma pizza
                    </button>
                {{ form_end(form) }}
            </div>

            <!-- Liste des pizzas -->
            <div class="card">
                <h2>
                    <span>üì¶</span>
                    Inventaire ({{ pizzas|length }})
                </h2>
                
                {% if pizzas is empty %}
                    <div class="empty-state">
                        <div class="empty-state-icon">üçï</div>
                        <p>Aucune pizza cr√©√©e pour l'instant.</p>
                        <p>Commencez par cr√©er votre premi√®re pizza !</p>
                    </div>
                {% else %}
                    <div class="pizza-list">
                        {% for pizza in pizzas %}
                            <div class="pizza-item">
                                <div class="pizza-info">
                                    <h3>{{ pizza.name }}</h3>
                                    <div class="pizza-detail">
                                        <strong>Ingr√©dient secret:</strong> {{ pizza.specialIngredient }}
                                    </div>
                                    <div class="pizza-detail">
                                        <strong>P√¢te:</strong> {{ pizza.doughType.name }}
                                    </div>
                                    {% if pizza.ingredients|length > 0 %}
                                        <div class="pizza-detail">
                                            <strong>Ingr√©dients:</strong>
                                            {% for ingredient in pizza.ingredients %}
                                                {{ ingredient.name }}{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="pizza-owner">
                                        üë§ {{ pizza.owner.username }}
                                    </div>
                                </div>
                                
                                {% if app.user == pizza.owner %}
                                    <div class="pizza-actions">
                                        <a href="{{ path('app_pizza_edit', {'id': pizza.id}) }}" class="btn-action btn-edit">
                                            ‚úèÔ∏è Modifier
                                        </a>
                                        <form method="post" action="{{ path('app_pizza_delete', {'id': pizza.id}) }}" 
                                              onsubmit="return confirm('Voulez-vous vraiment supprimer cette pizza ?');" 
                                              class="delete-form">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ pizza.id) }}">
                                            <button type="submit" class="btn-action btn-delete">
                                                üóëÔ∏è Supprimer
                                            </button>
                                        </form>
                                    </div>
                                {% else %}
                                    <div class="no-access">
                                        üîí Pizza d'un autre utilisateur
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
